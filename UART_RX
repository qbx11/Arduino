#include <avr/io.h>
#include <stdlib.h>
#include <string.h>
#include <util/delay.h>
 
#ifndef _BV
#define _BV(bit)        (1<<(bit))
#endif
#ifndef sbi
#define sbi(reg,bit)    reg |= (_BV(bit))
#endif
 
#ifndef cbi
#define cbi(reg,bit)    reg &= ~(_BV(bit))
#endif

#ifndef tbi
#define tbi(reg,bit)    reg ^= (_BV(bit))
#endif

void UART_init(){
    uint16_t ubrr = 51; //USART Baud Rate Register (holds baud rate value) 51 -> 19200
    UBRR0H = 0; //UBRR is divided between two registers
    UBRR0L = 51;

    sbi(UCSR0C,UCSZ01);sbi(UCSR0C,UCSZ00); //8 bit data

    sbi(UCSR0B,TXEN0);//transmiterr enable 
    sbi(UCSR0B,RXEN0);//receiver enable 


}

char uart_getchar(){
  while(bit_is_clear(UCSR0A,RXC0)){}
  return UDR0;
}

void uart_char(char c){
  while(bit_is_clear(UCSR0A, UDRE0)){}//if buffer is empty
  UDR0 =c; //buffer equals c
  
}

void uart_string(const char* str) {
    while (*str) {
        uart_char(*str++);
    }
}



int main() {
  UART_init();

  while(1){
      
      uart_string("\r\nPodaj litere: ");
      char c;
      do { //to ignore \r and \n from clicking enter on keyboar
             c = uart_getchar();
        } while (c == '\r' || c == '\n');

      uart_string("\r\nPodales: ");
      uart_char(c);
      _delay_ms(2000);
  
  }
 
}
